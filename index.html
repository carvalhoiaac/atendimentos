<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard de Atendimentos (Refatorado)</title>
  <!-- Biblioteca para ler Excel -->
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Estilos Customizados -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="dashboard">
    <h1 class="mb-4 text-center"><img src="relatorio-de-saude.gif" alt="Ícone de relatório" style="height: 30px; vertical-align: middle; margin-right: 10px;"> Painel de Atendimentos por Profissional</h1>

    <!-- Filtros e Controles -->
    <div class="filters row g-3 align-items-end mb-3">
      <div class="col-md-5">
        <label for="clinicSelect" class="form-label">1. Selecionar Clínica</label>
        <select id="clinicSelect" class="form-select">
          <option value="">-- Selecione --</option>
          <option value="MATRIZ">Matriz</option>
          <option value="ATUBA">Atuba</option>
          <option value="BALNEARIO">Balneário</option>
          <option value="ITAPEMA">Itapema</option>
          <option value="JOINVILLE">Joinville</option>
          <option value="MAFRA">Mafra</option>
          <option value="PONTA GROSSA">Ponta Grossa</option>
          <option value="LAGES">Lages</option>
          <option value="FAZENDA RIO GRANDE">Fazenda Rio Grande</option>
          <option value="SÃO JOSÉ DOS PINHAIS">São José dos Pinhais</option>
        </select>
      </div>
      <div class="col-md-5">
        <label for="fileInput" class="form-label">2. Anexar Planilha Excel</label>
        <input
          type="file"
          id="fileInput"
          class="form-control"
          accept=".xlsx, .xls"
        />
      </div>
       <div class="col-md-2 d-flex align-items-end">
          <button id="clearButton" class="btn btn-secondary w-100">Limpar Dados</button>
      </div>
    </div>

    <!-- Controles de Ordenação e Busca -->
    <div class="row g-3 mb-4 align-items-center">
        <div class="col-md-4">
            <label for="sortSelect" class="form-label">Ordenar Profissionais Por:</label>
            <select id="sortSelect" class="form-select">
                <option value="nome_asc">Nome (A-Z)</option>
                <option value="nome_desc">Nome (Z-A)</option>
                <option value="total_desc">Total Atendimentos (Maior)</option>
                <option value="total_asc">Total Atendimentos (Menor)</option>
                <option value="finalizados_desc">% Finalizados (Maior)</option>
                <option value="finalizados_asc">% Finalizados (Menor)</option>
                <option value="nao_finalizados_desc">Não Finalizados (Maior)</option>
                <option value="nao_finalizados_asc">Não Finalizados (Menor)</option>
                <option value="abertos_desc">Abertos (Maior)</option> <!-- Adicionado ordenação por abertos -->
                <option value="abertos_asc">Abertos (Menor)</option> <!-- Adicionado ordenação por abertos -->
            </select>
        </div>
        <!-- Espaço reservado para busca, limite de destaque e exportação -->
        <div class="col-md-8 d-flex justify-content-end align-items-end">
             <div class="me-2 flex-grow-1">
                 <label for="searchInput" class="form-label visually-hidden">Buscar Profissional</label>
                 <input type="search" id="searchInput" class="form-control form-control-sm" placeholder="Buscar por nome..." disabled>
             </div>
             <div class="me-2" style="width: 150px;"> <!-- Ajuste a largura conforme necessário -->
                 <label for="highlightThresholdInput" class="form-label visually-hidden">Limite Destaque</label>
                 <div class="input-group input-group-sm">
                    <span class="input-group-text">Destaque &gt;</span>
                    <input type="number" id="highlightThresholdInput" class="form-control" value="10" min="0" disabled>
                 </div>
             </div>
             <button id="exportCsvButton" class="btn btn-success btn-sm ms-2" disabled>Exportar (CSV)</button>
        </div> 
    </div>

    <!-- Área de Mensagens -->
    <div id="messageArea" class="mb-3"></div>

    <!-- Painel de KPIs -->
    <div class="kpi mb-4" id="kpiPanel">
        <!-- KPIs serão renderizados aqui pelo JavaScript -->
        <p class="text-center text-muted">Nenhum dado carregado ainda. Selecione uma clínica e anexe uma planilha.</p>
    </div>

    <!-- Cards de Profissionais -->
    <div id="clinicCards">
        <!-- Cards dos profissionais serão renderizados aqui -->
    </div>

  </div>

  <!-- Bootstrap JS Bundle (Necessário para Modals, etc.) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Script do Dashboard (deferido para executar após o parse do HTML) -->
  <script src="dashboard.js" defer></script>
</body>
</html>



<!-- Modal para Detalhes do Profissional -->
<div class="modal fade" id="professionalDetailModal" tabindex="-1" aria-labelledby="professionalDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="professionalDetailModalLabel">Detalhes dos Atendimentos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="professionalDetailModalBody">
        <!-- Conteúdo do modal será preenchido pelo JavaScript -->
        <p>Carregando detalhes...</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

